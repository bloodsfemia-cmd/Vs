<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneShot - Crea Sfida</title>
    <style>
        :root {
            --gold: #d4af37;
            --dark: #0a0a0a;
            --gray: #1a1a1a;
            --light-gold: #e8c670;
        }
        body { margin: 0; background: var(--dark); color: var(--gold); font-family: 'Georgia', serif; min-height: 100vh; display: flex; flex-direction: column; }
        header { background: rgba(0,0,0,0.85); padding: 1.2rem; text-align: center; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 100; }
        header h1 { font-size: clamp(1.8rem, 4vw, 2.8rem); letter-spacing: 4px; text-transform: uppercase; }
        .container { flex: 1; max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        h2 { text-align: center; margin-bottom: 1.5rem; color: var(--light-gold); font-size: 2rem; }
        .number-buttons { display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin-bottom: 2rem; }
        .number-btn { background: transparent; color: var(--gold); border: 2px solid var(--gold); padding: 0.8rem 1.5rem; font-size: 1.3rem; cursor: pointer; border-radius: 8px; transition: 0.3s; }
        .number-btn:hover, .number-btn.active { background: var(--gold); color: #000; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .participant-card { background: #111; padding: 1.2rem; border-radius: 10px; border: 1px solid var(--gold); }
        .participant-card h3 { text-align: center; margin-bottom: 0.8rem; font-size: 1.2rem; }
        .participant-card input { width: 100%; padding: 0.8rem; margin: 0.6rem 0; background: #000; border: 1px solid var(--light-gold); color: white; border-radius: 6px; font-size: 1rem; }
        .participant-card input:focus { outline: none; border-color: var(--light-gold); box-shadow: 0 0 0 3px rgba(212,175,55,0.2); }
        .participant-card.error { border-color: #ff4444; box-shadow: 0 0 10px rgba(255,68,68,0.3); }
        .start-btn, .share-btn { background: transparent; color: var(--gold); border: 3px solid var(--gold); padding: 1rem 2.5rem; font-size: 1.4rem; font-weight: bold; text-transform: uppercase; border-radius: 8px; cursor: pointer; margin: 1.5rem; transition: 0.3s; }
        .start-btn:hover, .share-btn:hover { background: var(--gold); color: #000; }
        .actions { text-align: center; }
        #game { display: none; }
        .vs-container { flex: 1; display: flex; position: relative; }
        .vs-box { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .vs-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--gold); color: #000; font-size: 5rem; padding: 2rem 3.5rem; border-radius: 50%; border: 10px solid #000; z-index: 10; font-weight: bold; }
        .participant-img { width: 80%; max-height: 65vh; object-fit: contain; border: 4px solid var(--gold); border-radius: 12px; box-shadow: 0 10px 50px rgba(0,0,0,0.7); }
        .participant-name { font-size: 2.5rem; margin: 1.5rem 0; text-align: center; text-transform: uppercase; letter-spacing: 2px; }
        #contatore { background: rgba(0,0,0,0.85); padding: 1.5rem; text-align: center; font-size: 1.5rem; border-top: 2px solid var(--gold); }
        #sfidaTitle { background: rgba(0,0,0,0.7); padding: 1rem; text-align: center; font-size: 2.2rem; border-bottom: 1px solid var(--gold); position: sticky; top: 0; z-index: 20; }
    </style>
</head>
<body>
<header>
    <h1>OneShot</h1>
</header>

<div class="container" id="creator">
    <div class="step">
        <h2>1. Quanti partecipanti? (pari, max 100)</h2>
        <div class="number-buttons" id="numButtons"></div>
    </div>

    <div class="step" id="formStep" style="display:none;">
        <h2>2. Inserisci nome e foto (esattamente <span id="numScelto"></span> quadrati)</h2>
        <div class="grid" id="gridInputs"></div>
        <div class="actions">
            <button class="start-btn" onclick="avviaTorneo()">Inizia Sfida</button>
        </div>
    </div>
</div>

<div id="game">
    <div id="sfidaTitle"></div>
    <div class="vs-container">
        <div class="vs-text">VS</div>
        <div onclick="scegli(0)" class="vs-box">
            <img id="img-sinistra" class="participant-img" src="" referrerpolicy="no-referrer">
            <div class="participant-name" id="nome-sinistro"></div>
        </div>
        <div onclick="scegli(1)" class="vs-box">
            <img id="img-destra" class="participant-img" src="" referrerpolicy="no-referrer">
            <div class="participant-name" id="nome-destro"></div>
        </div>
    </div>
    <div id="contatore">Rimanenti: <span id="num-restanti">0</span></div>
</div>

<script>
    let partecipanti = [];
    let inGara = [];
    let vincitoreAttuale;
    let sfidanteAttuale;
    let selectedNum = 0;

    // Bottoni numeri pari 4-100
    const numButtons = document.getElementById('numButtons');
    for (let i = 4; i <= 100; i += 2) {
        const btn = document.createElement('button');
        btn.className = 'number-btn';
        btn.textContent = i;
        btn.onclick = () => selezionaNumero(i, btn);
        numButtons.appendChild(btn);
    }

    function selezionaNumero(num, btnSelezionato) {
        selectedNum = num;
        document.querySelectorAll('.number-btn').forEach(b => b.classList.remove('active'));
        btnSelezionato.classList.add('active');

        const grid = document.getElementById('gridInputs');
        grid.innerHTML = '';
        partecipanti = [];

        for (let i = 1; i <= num; i++) {
            const card = document.createElement('div');
            card.className = 'participant-card';
            card.innerHTML = `
                <h3>Partecipante ${i}</h3>
                <input type="text" placeholder="Nome (es. Lady Gaga)" class="nome-input">
                <input type="text" placeholder="Link foto diretta (.jpg/.png)" class="foto-input">
            `;
            grid.appendChild(card);
            partecipanti.push(card);
        }

        document.getElementById('numScelto').innerText = num;
        document.getElementById('formStep').style.display = 'block';
        window.scrollTo({ top: document.getElementById('formStep').offsetTop - 100, behavior: 'smooth' });
    }

    function avviaTorneo() {
        const lista = [];
        let valido = true;

        partecipanti.forEach(card => {
            const nome = card.querySelector('.nome-input').value.trim();
            const foto = card.querySelector('.foto-input').value.trim();
            if (!nome || !foto) {
                valido = false;
                card.classList.add('error');
            } else {
                card.classList.remove('error');
                lista.push({nome, foto});
            }
        });

        if (!valido) return alert('Completa tutti i campi!');

        inGara = [...lista];
        inGara.sort(() => Math.random() - 0.5);
        vincitoreAttuale = inGara.pop();

        document.getElementById('creator').style.display = 'none';
        document.getElementById('game').style.display = 'flex';
        document.getElementById('sfidaTitle').innerText = document.getElementById('nomeSfida')?.value.trim() || 'Sfida Personalizzata';

        aggiornaSchermata();
    }

    function aggiornaSchermata() {
        if (inGara.length > 0) {
            sfidanteAttuale = inGara.pop();
            document.getElementById('img-sinistra').src = vincitoreAttuale.foto;
            document.getElementById('nome-sinistro').innerText = vincitoreAttuale.nome;
            document.getElementById('img-destra').src = sfidanteAttuale.foto;
            document.getElementById('nome-destro').innerText = sfidanteAttuale.nome;
            document.getElementById('num-restanti').innerText = inGara.length + 1;
        } else {
            mostraPodio();
        }
    }

    function scegli(lato) {
        if (lato === 1) vincitoreAttuale = sfidanteAttuale;
        aggiornaSchermata();
    }

    function mostraPodio() {
        document.getElementById('game').innerHTML = `
            <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#000; color:var(--gold);">
                <h1 style="font-size:5vw; letter-spacing:12px;">CAMPIONE ASSOLUTO</h1>
                <img src="${vincitoreAttuale.foto}" referrerpolicy="no-referrer" style="width:450px; max-height:70vh; object-fit:contain; border:8px solid var(--gold); border-radius:15px; margin:40px 0; box-shadow:0 20px 60px rgba(0,0,0,0.8);" onerror="this.src='https://via.placeholder.com/450x700/111/ccc?text=${encodeURIComponent(vincitoreAttuale.nome)}';">
                <h2 style="font-size:6vw; margin:30px 0;">${vincitoreAttuale.nome}</h2>
                <button onclick="location.reload()" style="padding:25px 70px; background:transparent; color:var(--gold); border:4px solid var(--gold); border-radius:10px; font-size:2vw; cursor:pointer; text-transform:uppercase; font-weight:bold;">Nuova Sfida</button>
            </div>`;
        document.getElementById('contatore').style.display = 'none';
    }

    document.getElementById('img-sinistra').onerror = function() {
        this.src = 'https://via.placeholder.com/400x600/111/ccc?text=' + encodeURIComponent(document.getElementById('nome-sinistro').innerText || 'Partecipante');
    };
    document.getElementById('img-destra').onerror = function() {
        this.src = 'https://via.placeholder.com/400x600/111/ccc?text=' + encodeURIComponent(document.getElementById('nome-destro').innerText || 'Partecipante');
    };
</script>
</body>
</html>
